<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
 <h2 id="titiletext">Spring3核心技术之事务管理机制</h2>
                <div class="article_data">
                    <div class="article_data_left">
                        2014-06-06
                        <span class="a_username">&nbsp;<a href="http://www.360doc.com/userhome/13272601" id="savernickname" target="_blank" onclick="wzhitnew(1);">纯属爱</a>
                        </span>
                        <span id="articleinfo">
                            <span id="docsource" class="a_from"></span><span id="360doc_Readnum"></span><span id="360docResaveCount"><span onclick="ShowSaverUser();wzhitnew(3);" id="360doc_saverNum" style="cursor: pointer;"></span>
                                <span id="360doc_saverUser">
                                    <div style="position: absolute; height: 305px; width: 144px; left: 0px; z-index: 2;" id="sameArtOuter">
                                        <div onclick="event.cancelBubble=true;" style="overflow-y: auto; height: 300px; overflow-x: hidden; z-index: 100; right: 0px; margin-top: -10px;" id="sameArt">
                                        </div>
                                    </div>
                                </span>
                            </span>
                        </span>
                    </div>
                    <div id="resavelayer1" class="bdsharebuttonbox article_data_right">
                    </div>
                </div>
                <div id="articlecontent" class="article_container" onmousedown="newhighlight = true;" onmouseup="NewHighlight(event);">
                    <table>
                        <tbody>
                            <tr>
                                <td id="artContent" width="656">
                                    <p><span style="font-family:Helvetica,Tahoma,Arial,sans-serif"><span style="line-height:25.1875px"><span style="font-size:24px; color:#ff0000">文章转至http://zhou137520.iteye.com/blog/1675199</span></span></span></p>
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">Spring对事务的解决办法其实分为2种：编程式实现事务，AOP配置声明式解决方案。</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span></p>
<a href="http://jinnianshilongnian.iteye.com/blog/1496953" target="_blank" style="color: rgb(0, 102, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">http://jinnianshilongnian.iteye.com/blog/1496953</a><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">Spring提供了许多内置事务管理器实现，常用的有以下几种：</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<ul style="margin-bottom: 1.5em; font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<li style="margin-bottom: 0.25em; margin-left: 30px;"><span style="color:blue">DataSourceTransactionManager</span>：位于org.springframework.jdbc.datasource包中，数据源事务管理器，提供对单个javax.sql.DataSource事务管理，用于Spring JDBC抽象框架、iBATIS框架的事务管理；</li><li style="margin-bottom: 0.25em; margin-left: 30px;"><span style="color:blue">HibernateTransactionManager</span>：位于org.springframework.orm.hibernate3或者hibernate4包中，提供对单个org.hibernate.SessionFactory事务支持，用于集成Hibernate框架时的事务管理；该事务管理器只支持Hibernate3+版本，且Spring3.0+版本只支持Hibernate
 3.2+版本；</li><li style="margin-bottom: 0.25em; margin-left: 30px;"><span style="color:blue">JtaTransactionManager</span>：位于org.springframework.transaction.jta包中，提供对分布式事务管理的支持，并将事务管理委托给Java EE应用服务器事务管理器；</li></ul>
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">Spring不仅提供这些事务管理器，还提供对如JMS事务管理的管理器</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">两个不依赖于应用服务器的开源JTA事务实现组件</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：JOTM和Atomikos Transactions Essentials&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">具体用法参考</span><a href="http://jinnianshilongnian.iteye.com/blog/1439900" target="_blank" style="color: rgb(0, 102, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">http://jinnianshilongnian.iteye.com/blog/1439900</a><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">这篇博客讲解了对于JDBC和JTA分别用PlatformTransactionManager实现和使用TransactionTemplate实现编程式事务管理：</span><a href="http://jinnianshilongnian.iteye.com/blog/1441271" target="_blank" style="color: rgb(0, 102, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">http://jinnianshilongnian.iteye.com/blog/1441271</a><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">编程式实现事务</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;">Spring提供两种编程式事务支持：直接使用PlatformTransactionManager实现和使用TransactionTemplate模板类，用于支持逻辑事务管理。</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">如果采用编程式事务推荐使用TransactionTemplate模板类。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">Spring框架支持事务管理的核心是事务管理器抽象，对于不同的数据访问框架（如Hibernate）通过实现策略接口PlatformTransactionManager，从而能支持各种数据访问框架的事务管理，PlatformTransactionManager接口定义如下：</span></p>
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"></span></p>
<div><div><div><b>[java]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 1068px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_1" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=1&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>public&nbsp;interface&nbsp;PlatformTransactionManager&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//返回一个已经激活的事务或创建一个新的事务&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TransactionStatus&nbsp;getTransaction(TransactionDefinition&nbsp;definition)&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throws&nbsp;TransactionException;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;commit(TransactionStatus&nbsp;status)&nbsp;throws&nbsp;TransactionException;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;rollback(TransactionStatus&nbsp;status)&nbsp;throws&nbsp;TransactionException;&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div>
<p>
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><br>
</span></p>
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">关于TransactionDefinition接口和TransactionStatus接口：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<a href="http://jinnianshilongnian.iteye.com/blog/1439900" target="_blank" style="color: rgb(0, 102, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">http://jinnianshilongnian.iteye.com/blog/1439900</a><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span>
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><br>
</span></p>
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">Spring声明式事务&nbsp;<br>
在日常开发中，用的最多的就是声明式事务了，下面将介绍SpringJdbc的声明式事务的配置方法：</span></p>
<p><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"></span></p>
<div><div><div><b>[html]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 1413px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_2" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=2&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>&lt;context:component-scan&nbsp;base-package="com.chou.spring.jdbc"/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&lt;!--&nbsp;配置数据源&nbsp;--&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&lt;bean&nbsp;id="dataSource"&nbsp;class="com.mchange.v2.c3p0.ComboPooledDataSource"&nbsp;destroy-method="close"&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Connection&nbsp;Info&nbsp;--&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="driverClass"&nbsp;value="${db.driverClass}"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="jdbcUrl"&nbsp;value="${db.url}"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="user"&nbsp;value="${db.username}"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="password"&nbsp;value="${db.password}"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;!--&nbsp;Connection&nbsp;Pooling&nbsp;Info&nbsp;--&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="initialPoolSize"&nbsp;value="1"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="minPoolSize"&nbsp;value="1"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="maxPoolSize"&nbsp;value="15"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="maxIdleTime"&nbsp;value="1800"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="maxStatements"&nbsp;value="0"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&lt;bean&nbsp;id="jdbcTemplateDao"&nbsp;class="com.chou.spring.jdbc.dao.JdbcTemplateDao"&nbsp;&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="dataSource"&nbsp;ref="dataSource"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&lt;!--&nbsp;JDBC事务管理器&nbsp;--&gt;&nbsp;&nbsp;</li><li>&lt;bean&nbsp;id="jdbctTxManager"&nbsp;class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="dataSource"&nbsp;ref="dataSource"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&lt;tx:advice&nbsp;id="txAdvice"&nbsp;transaction-manager="jdbctTxManager"&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:attributes&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="domain*"/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tx:attributes&gt;&nbsp;&nbsp;</li><li>&lt;/tx:advice&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&lt;aop:config&nbsp;proxy-target-class="true"&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;aop:advisor&nbsp;advice-ref="txAdvice"&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;pointcut="execution(*&nbsp;com.chou.spring.jdbc.service.JdbcTemplateService.*(..))"/&gt;&nbsp;&nbsp;</li><li>&lt;/aop:config&gt;&nbsp;&nbsp;</li></ol></div><br>
<div><div><div><b>[java]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 2174px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_3" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=3&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>public&nbsp;class&nbsp;JdbcTemplateDao&nbsp;extends&nbsp;JdbcDaoSupport{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;save()&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;insertSql&nbsp;=&nbsp;"insert&nbsp;into&nbsp;tab_item&nbsp;values(?,?,?)";&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.isTrue(getJdbcTemplate().update(insertSql,&nbsp;new&nbsp;Object[]{6,&nbsp;"HP",&nbsp;"PT540"})&nbsp;==&nbsp;1,&nbsp;"插入失败");&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;delete()&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;deleteSql&nbsp;=&nbsp;"delete&nbsp;tab_item&nbsp;where&nbsp;id&nbsp;=&nbsp;?";&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.isTrue(getJdbcTemplate().update(deleteSql,&nbsp;new&nbsp;Object[]{6})&nbsp;==&nbsp;1,&nbsp;"删除失败");&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;update()&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;updateSql&nbsp;=&nbsp;"update&nbsp;tab_item&nbsp;set&nbsp;itemno&nbsp;=&nbsp;?,&nbsp;itemname&nbsp;=&nbsp;?&nbsp;where&nbsp;id&nbsp;=&nbsp;?";&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assert.isTrue(getJdbcTemplate().update(updateSql,&nbsp;new&nbsp;Object[]{"HP",&nbsp;"PT555",&nbsp;6})&nbsp;==&nbsp;1,&nbsp;"修改失败");&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><br>
<div><div><div><b>[java]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 2575px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_4" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=4&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>/**&nbsp;</li><li>&nbsp;*&nbsp;&nbsp;</li><li>&nbsp;*&nbsp;@author&nbsp;Chou&nbsp;</li><li>&nbsp;*&nbsp;@since&nbsp;2012-9-9&nbsp;</li><li>&nbsp;*&nbsp;把事务定义在Service层是为了避免报错：&nbsp;</li><li>&nbsp;*&nbsp;All&nbsp;calls&nbsp;to&nbsp;this&nbsp;method&nbsp;via&nbsp;a&nbsp;proxy&nbsp;will&nbsp;be&nbsp;routed&nbsp;directly&nbsp;to&nbsp;the&nbsp;proxy.&nbsp;</li><li>&nbsp;*&nbsp;这是是事务转移问题，你如果在控制层加入事务就不会有提示了，也没有警告，&nbsp;</li><li>&nbsp;*&nbsp;一般很多人在final&nbsp;DAO里加入事务那是有警告的，&nbsp;</li><li>&nbsp;*&nbsp;如果配置文件定义了AOP获取代理对象是proxy-target-class="true"即采用CGLIB方式&nbsp;</li><li>&nbsp;*&nbsp;而cglib动态代理是利用asm开源包，对代理对象类的class文件加载进来，&nbsp;</li><li>&nbsp;*&nbsp;通过修改其字节码生成子类并继承你写的类,然后在你的基础上加事物管理,&nbsp;</li><li>&nbsp;*&nbsp;而JdbcDaoSupport中的setDataSource是final的他继承不了&nbsp;</li><li>&nbsp;*&nbsp;当然你可以无视它，也没有问题。&nbsp;</li><li>&nbsp;*/&nbsp;&nbsp;</li><li>@Service&nbsp;&nbsp;</li><li>public&nbsp;class&nbsp;JdbcTemplateService&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;@Autowired&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;JdbcTemplateDao&nbsp;jdbcTemplateDao;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;domain(){&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jdbcTemplateDao.save();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i&nbsp;=&nbsp;2/0;//这里出错了，事务就会回滚，之前的save就无效了&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jdbcTemplateDao.update();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jdbcTemplateDao.delete();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>//main方法&nbsp;&nbsp;</li><li>String[]&nbsp;configLocations&nbsp;=&nbsp;new&nbsp;String[]&nbsp;{"applicationContext.xml"};&nbsp;&nbsp;&nbsp;&nbsp;</li><li>ApplicationContext&nbsp;ctx&nbsp;=&nbsp;new&nbsp;ClassPathXmlApplicationContext(configLocations);&nbsp;&nbsp;</li><li>JdbcTemplateService&nbsp;j&nbsp;=&nbsp;ctx.getBean(JdbcTemplateService.class);&nbsp;&nbsp;</li><li>j.domain();&nbsp;&nbsp;</li></ol></div><br>
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><strong>&lt;tx:advice/&gt;配置详解</strong></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span>
<p>
<p><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.1875px"></span></p>
<div><div><div><b>[html]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 3289px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_5" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=5&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>&lt;tx:advice&nbsp;id="……"&nbsp;transaction-manager="……"&gt;&nbsp;&nbsp;</li><li>&lt;tx:attributes&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="*"&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;propagation="REQUIRED"&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isolation="DEFAULT"&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;timeout="-1"&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read-only="true"&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no-rollback-for=""&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rollback-for="java.lang.Exception"/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tx:attributes&gt;&nbsp;&nbsp;</li><li>&lt;/tx:advice&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&lt;!--&nbsp;最常用的配置&nbsp;--&gt;&nbsp;&nbsp;</li><li>&lt;tx:advice&nbsp;id="txAdvice"&nbsp;transaction-manager="txManager"&gt;&nbsp;&nnbsp;</li><li>&lt;tx:attributes&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="save*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="add*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="create*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="insert*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="update*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="merge*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="del*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="remove*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="put*"&nbsp;propagation="REQUIRED"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="get*"&nbsp;propagation="SUPPORTS"&nbsp;read-only="true"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="count*"&nbsp;propagation="SUPPORTS"&nbsp;read-only="true"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="find*"&nbsp;propagation="SUPPORTS"&nbsp;read-only="true"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="list*"&nbsp;propagation="SUPPORTS"&nbsp;read-only="true"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="*"&nbsp;propagation="SUPPORTS"&nbsp;read-only="true"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;tx:method&nbsp;name="batchSaveOrUpdate"&nbsp;propagation="REQUIRES_NEW"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/tx:attributes&gt;&nbsp;&nbsp;</li><li>&lt;/tx:advice&gt;&nbsp;&nbsp;</li><li>&lt;aop:config&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;aop:pointcut&nbsp;id="txPointcut"&nbsp;expression="execution(*&nbsp;cn.javass..service.*.*(..))"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;aop:advisor&nbsp;advice-ref="txAdvice"&nbsp;pointcut-ref="txPointcut"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&lt;/aop:config&gt;&nbsp;&nbsp;</li></ol></div><br>
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">XML形式的事务配置&lt;tx:method &gt;的属性详解</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span>
<p>
<p><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.1875px"></span>
</p><table style="border: 1px solid rgb(204, 204, 204); font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<tbody>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">
<div style="text-align:center">属性</div>
</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">
<div style="text-align:center">类型</div>
</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">
<div style="text-align:center">默认值</div>
</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">
<div style="text-align:center">说明</div>
</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">propagation</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">Propagation枚举</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">REQUIRED</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">事务传播属性</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">isolation</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">isolation枚举</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">DEFAULT(所用数据库默认级别)</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">事务隔离级别</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">readOnly</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">boolean</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">false</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">是否才用优化的只读事务</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">timeout</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">int</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">-1</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">超时(秒)</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">rollbackFor</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">Class[]</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">{}</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">需要回滚的异常类</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">rollbackForClassName</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">String[]</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">{}</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">需要回滚的异常类名</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">noRollbackFor</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">Class[]</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">{}</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">不需要回滚的异常类</td>
</tr>
<tr>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">noRollbackForClassName</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">String[]</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">{}</td>
<td style="font-size:1em; border:1px solid rgb(204,204,204); padding:3px">不需要回滚的异常类名</td>
</tr>
</tbody>
</table>
<br>
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">readOnly</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">事务属性中的readOnly标志表示对应的事务应该被最优化为只读事务。如果值为true就会告诉Spring我这个方法里面没有insert或者update，你只需要提供只读的数据库Connection就行了，这种</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: red;">执行效率会比read-write的Connection高，所以这是一个最优化提示</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">。在一些情况下，一些事务策略能够起到显著的最优化效果，例如在使用Object/Relational映射工具（如：Hibernate或TopLink）时避免dirty
 checking（试图“刷新”）。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">timeout</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">在属性中还有定义“timeout”值的选项，指定事务超时为几秒。一般不会使用这个属性。在JTA中，这将被简单地传递到J2EE服务器的事务协调程序，并据此得到相应的解释。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">Isolation Level(事务隔离等级)的5个枚举值</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">为什么事务要有Isolation Level这个属性？先回顾下数据库事务的知识：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;">第一类丢失更新(lost update)</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：在完全未隔离事务的情况下，两个事物更新同一条数据资源，某一事物异常终止，回滚造成第一个完成的更新也同时丢失。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;">第二类丢失更新(second lost updates)</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：是不可重复读的特殊情况，如果两个事务都读取同一行，然后两个都进行写操作，并提交，第一个事务所做的改变就会丢失。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;">脏读(dirty read)</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：如果第二个事务查询到第一个事务还未提交的更新数据，形成脏读。因为第一个事务你还不知道是否提交，所以数据不一定是正确的。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;">虚读(phantom read)</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：一个事务执行两次查询，第二次结果集包含第一次中没有或者某些行已被删除，造成两次结果不一致，只是另一个事务在这两次查询中间插入或者删除了数据造成的。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;">不可重复读(unrepeated read)</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：一个事务两次读取同一行数据，结果得到不同状态结果，如中间正好另一个事务更新了该数据，两次结果相异，不可信任。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">具体关于事务机制可以看我以前的博客：</span><a href="http://zhou137520.iteye.com/admin/blogs/1638574" target="_blank" style="color: rgb(0, 102, 0); font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">http://zhou137520.iteye.com/admin/blogs/1638574</a><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">当遇到以上这些情况时我们可以设置isolation下面这些枚举值：&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">DEFAULT</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：采用数据库默认隔离级别&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">SERIALIZABLE</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：最严格的级别，事务串行执行，资源消耗最大；&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">REPEATABLE_READ</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：保证了一个事务不会修改已经由另一个事务读取但未提交（回滚）的数据。避免了“脏读取”和“不可重复读取”的情况，但是带来了更多的性能损失。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">READ_COMMITTED</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">:大多数主流数据库的默认事务等级，保证了一个事务不会读到另一个并行事务已修改但未提交的数据，避免了“脏读取”。该级别适用于大多数系统。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">READ_UNCOMMITTED</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：保证了读取过程中不会读取到非法数据。隔离级别在于处理多事务的并发问题。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">关于propagation属性的7个传播行为</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;"><strong>REQUIRED</strong></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法必需在事务环境中运行，如果当前有事务环境就加入当前正在执行的事务环境，如果当前没有事务，就新建一个事务。这是默认值。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">SUPPORTS</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法加入当前事务环境，如果当前没有事务，就以非事务方式执行。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: blue;"><strong>MANDATORY</strong></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法必须加入当前事务环境，如果当前没有事务，就抛出异常。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">REQUIRES_NEW</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法总是会为自己发起一个新的事务，如果发现当前方法已运行在一个事务中,则原有事务被挂起,我自己创建一个属于自己的事务,直我自己这个方法commit结束,原先的事务才会恢复执行。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">NOT_SUPPORTED</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法以非事务方式执行操作，如果当前存在事务，就把当前事务挂起，等我以非事务的状态运行完，再继续原来的事务。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">NEVER</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法绝对不能在事务范围内执行，如果方法在某个事务范围内执行，容器就抛异常，只有没关联到事务，才正常执行。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">NESTED</span></span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">：指定当前方法执行时，如果已经有一个事务存在,则运行在这个嵌套的事务中.如果当前环境没有运行的事务，就新建一个事务，并与父事务相互独立，这个事务拥有多个可以回滚的保证点。就是指我自己内部事务回滚不会对外部事务造成影响，只对DataSourceTransactionManager事务管理器起效。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">注解形式@Transactional实现事务管理</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: red;">注意@Transactional只能被应用到public方法上</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">，对于其它非public的方法，如果标记了@Transactional也不会报错,但方法没有事务功能。&nbsp;</span><br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: red;">默认情况下，一个有事务的方法，遇到RuntiomeException时会回滚</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">。遇到受检查的异常是不会回滚的，要想所有异常都回滚，要加上属性rollbackFor={Exception.class}</span><p>
<p><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.1875px"></span></p>
<div><div><div><b>[html]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 5659px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_6" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=6&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>&lt;!--&nbsp;事务管理器配置&nbsp;--&gt;&nbsp;&nbsp;</li><li>&lt;bean&nbsp;id="txManager"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;class="org.springframework.orm.hibernate3.HibernateTransactionManager"&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&lt;property&nbsp;name="sessionFactory"&nbsp;ref="sessionFactory"&nbsp;/&gt;&nbsp;&nbsp;</li><li>&lt;/bean&gt;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&lt;!--&nbsp;使用annotation定义事务&nbsp;--&gt;&nbsp;&nbsp;</li><li>&lt;tx:annotation-driven&nbsp;transaction-manager="txManager"&nbsp;proxy-target-class="true"&nbsp;/&gt;&nbsp;&nbsp;</li></ol></div><br>
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;"><span style="color:blue">transaction-manager</span>：指定事务管理器名字，默认为transactionManager，当使用其他名字时需要明确指定；&nbsp;<br>
<span style="color:blue">proxy-target-class</span>：默认false表示使用JDK代理，如果为true将使用CGLIB代理&nbsp;<br>
<span style="color:blue">order</span>：定义事务通知顺序，默认Ordered.LOWEST_PRECEDENCE，表示将顺序决定权交给AOP来处理。&nbsp;<br>
<br>
<span style="color:red">建议只在实现类或实现类的方法上使用@Transactional</span>，而不要在接口上使用，这是因为如果使用JDK代理机制是没问题，因为其使用基于接口的代理；而使用使用CGLIB代理机制时就会遇到问题，因为其使用基于类的代理而不是接口，这是因为接口上的@Transactional注解是“不能继承的”。&nbsp;<br>
<a href="http://jinnianshilongnian.iteye.com/blog/1508018" target="_blank" style="color:rgb(0,102,0)">http://jinnianshilongnian.iteye.com/blog/1508018</a>这篇博客讲解了基于JDK动态代理和CGLIB动态代理的实现Spring注解管理事务（@Trasactional）到底有什么区别。</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;</span>
<p>
<p><span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:25.1875px"></span></p>
<div><div><div><b>[java]</b> <a href="" title="view plain">view plain</a><a href="" title="copy">copy</a><div style="position: absolute; left: 395px; top: 6080px; width: 18px; height: 18px; z-index: 0;"><embed src="http://static.blog.csdn.net/scripts/ZeroClipboard/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="18" height="18" name="ZeroClipboardMovie_7" align="middle" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="id=7&amp;width=18&amp;height=18" wmode="transparent" style="z-index: 0;"></div></div></div><ol start="1"><li>@Transactional//放在这里表示所有方法都加入事务管理&nbsp;&nbsp;</li><li>public&nbsp;class&nbsp;AnnotationUserServiceImpl&nbsp;implements&nbsp;IUserService&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;IUserDao&nbsp;userDao;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;IAddressService&nbsp;addressService;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;@Transactional(propagation=Propagation.REQUIRED,&nbsp;isolation=Isolation.READ_COMMITTED)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;save(UserModel&nbsp;user)&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;userDao.save(user);&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.getAddress().setUserId(user.getId());&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addressService.save(user.getAddress());&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;@Transactional(propagation=Propagation.REQUIRED,&nbsp;readOnly=true,&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isolation=Isolation.READ_COMMITTED)&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;int&nbsp;countAll()&nbsp;{&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;userDao.countAll();&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;&nbsp;</li><li>&nbsp;&nbsp;&nbsp;&nbsp;//setter...&nbsp;&nbsp;</li><li>}&nbsp;&nbsp;</li></ol></div><br>
<br>
<br>
<p>
<div style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; text-align: center;">
<strong>总结</strong></div>
<br style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">
<span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: Helvetica, Tahoma, Arial, sans-serif; line-height: 25.1875px; color: rgb(139, 0, 0);">编程式事务是不推荐的，即使有很少事务操作，Spring发展到现在，没有理由使用编程式事务，只有在为了深入理解Spring事务管理才需要学习编程式事务使用。&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 推荐使用声明式事务，而且强烈推荐使用&lt;tx:tags&gt;方式的声明式事务，因为其是无侵入代码的，可以配置模板化的事务属性并运用到多个项目中。&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 而@Transaction注解事务，不过如果一个项目模块太多，service方法太多导致每个方法都要手动去加注解，是不是很麻烦，也容易出错。如果一个项目结构清晰，分层明确，那么标签形式的配置将是最直观和方便的办法。&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 总之，能保证项目正常工作的事务配置就是最好的。&nbsp;<img src="http://image73.360doc.com/DownloadImg/2014/06/0623/42375852_1.gif" alt=""></span><br>
</body>
</html>